{% extends 'base.html' %}

{% block page_content %}
{% if page_obj.paginator.count %}
<section class="section full-height" id="practice-list-grid">
  {% include 'partials/_practice.html' %}
</section>
<section id="practice-list-actions">
  <div class="practice-list-action">
    <a class="button is-fullwidth" href="{% if page_obj.has_previous %}{{ page_obj.previous_page_number }}{% endif %}" {% if not page_obj.has_previous %}disabled{% endif %}>
      <i class="fas fa-long-arrow-alt-left"></i>&nbsp;More Recent
    </a>
  </div>
  <div class="practice-list-action">
    <a class="button is-fullwidth" href="{% if page_obj.has_next %}{{ page_obj.next_page_number }}{% endif %}" {% if not page_obj.has_next %}disabled{% endif %}>
      Older&nbsp;<i class="fas fa-long-arrow-alt-right"></i>
    </a>
  </div>
</section>
{% else %}
{% include 'partials/_start_practicing.html' %}
{% endif %}
<script>
window.onload = () => {
  document.addEventListener('keydown', (event) => {
    const rightArrow = 39
    const leftArrow = 37
    let xhr = new XMLHttpRequest();

    if (event.keyCode === rightArrow) {
      xhr.open('GET', '{% if page_obj.has_previous %}{{ page_obj.previous_page_number }}{% endif %}')
      xhr.send()
    } else if (event.keyCode === leftArrow) {
      xhr.open('GET', '{% if page_obj.has_next %}{{ page_obj.next_page_number }}{% endif %}')
      xhr.send()
    }

    xhr.onreadystatechange = () => {
      if (xhr.readyState == XMLHttpRequest.DONE && xhr.status === 200) {
        window.location.replace(xhr.responseURL)
        document.getElementById("practice-list-grid").focus();
      } else {
        console.log("Error: ", xhr)
      }
    }

    xhr.onerror = () => location.reload()
  })
}

document.addEventListener('DOMContentLoaded', () => {
  const practiceDates = Array.from(document.getElementsByClassName('list-item-practice-date'))
  practiceDates.forEach(span => span.textContent = moment(new Date(span.textContent)).format('LL'))
})
</script>
{% endblock %}
